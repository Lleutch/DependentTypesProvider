<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Dependent Types via an F# Type Provider
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="An F# type provider that provides dependent string and numeric types"/>
    <meta name="author" content="Christopher Atkins"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/DependentTypesProvider/content/style.css" />
    <script type="text/javascript" src="/DependentTypesProvider/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/caindy/DependentTypesProvider">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/DependentTypesProvider/index.html">DependentTypesProvider</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Dependent-Types-via-an-F-Type-Provider" class="anchor" href="#Dependent-Types-via-an-F-Type-Provider">Dependent Types via an F# Type Provider</a></h1>
<p>Let's look at the case of a Product Description from some hypothetical domain.
Typically you'd make a decision on what constitutes a valid Product Description,
then write some static validation functions that are utilized when checking a
string input that is meant to be used as a Product Description. Thereafter, the
string would just be a string, and we'd rely on labels (local bindings and property names)
to distinguish it as a Product Description.</p>
<p>This library allows us to encode those rules about what constitutes a valid
Product Description into a type.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// we need this to get access to the type providers in this library</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">FSharp</span><span class="o">.</span><span class="i">DependentTyping</span>

<span class="c">// this is the provided namesapce containing BoundedString</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="i">FSharp</span><span class="o">.</span><span class="i">DependentTypes</span><span class="o">.</span><span class="i">Strings</span>

<span class="c">// define a type alias `ProductDescription` for a string with least ten characters and at most two thousand</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="t">ProductDescription</span> <span class="o">=</span> <span class="i">BoundedString</span><span class="o">&lt;</span><span class="i">Lower</span><span class="o">=</span><span class="n">10</span>, <span class="i">Upper</span><span class="o">=</span><span class="n">2000</span><span class="o">&gt;</span>

<span class="c">// the static parameter names can be omitted</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="t">ProductName</span> <span class="o">=</span> <span class="i">BoundedString</span><span class="o">&lt;</span><span class="n">5</span>, <span class="n">50</span><span class="o">&gt;</span>

<span class="c">// fixed-length strings are supported</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="t">OneChar</span> <span class="o">=</span> <span class="i">BoundedString</span><span class="o">&lt;</span><span class="n">1</span>, <span class="n">1</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<h1><a name="Creating-and-Using-Instances" class="anchor" href="#Creating-and-Using-Instances">Creating and Using Instances</a></h1>
<p>There are two ways to create instances of our dependent types: constructors and static factory methods.
The Factory methods are preferred, as these are total functions that produce an <code>Option</code> type.
The constructors will throw an exception if the input does not conform.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="t">Product</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="i">Name</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs3', 8)" onmouseover="showTip(event, 'fs3', 8)" class="t">ProductName</span>; <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="i">Description</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 10)" onmouseover="showTip(event, 'fs2', 10)" class="t">ProductDescription</span> }

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="f">newProduct</span> (<span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="i">name</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs10', 13)" onmouseover="showTip(event, 'fs10', 13)" class="t">string</span>) (<span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="i">description</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs10', 15)" onmouseover="showTip(event, 'fs10', 15)" class="t">string</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs5', 16)" onmouseover="showTip(event, 'fs5', 16)" class="t">Product</span> <span onmouseout="hideTip(event, 'fs12', 17)" onmouseover="showTip(event, 'fs12', 17)" class="t">option</span> <span class="o">=</span>
  <span class="k">match</span> <span onmouseout="hideTip(event, 'fs3', 18)" onmouseover="showTip(event, 'fs3', 18)" class="i">ProductName</span><span class="o">.</span><span class="i">TryCreate</span>(<span onmouseout="hideTip(event, 'fs9', 19)" onmouseover="showTip(event, 'fs9', 19)" class="i">name</span>), <span onmouseout="hideTip(event, 'fs2', 20)" onmouseover="showTip(event, 'fs2', 20)" class="i">ProductDescription</span><span class="o">.</span><span class="i">TryCreate</span>(<span onmouseout="hideTip(event, 'fs11', 21)" onmouseover="showTip(event, 'fs11', 21)" class="i">description</span>) <span class="k">with</span>
  | <span onmouseout="hideTip(event, 'fs13', 22)" onmouseover="showTip(event, 'fs13', 22)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs14', 23)" onmouseover="showTip(event, 'fs14', 23)" class="i">n</span>, <span onmouseout="hideTip(event, 'fs13', 24)" onmouseover="showTip(event, 'fs13', 24)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs15', 25)" onmouseover="showTip(event, 'fs15', 25)" class="i">d</span> <span class="k">-&gt;</span> { <span class="i">Name</span> <span class="o">=</span> <span class="i">n</span>; <span class="i">Description</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 26)" onmouseover="showTip(event, 'fs15', 26)" class="i">d</span> }
  | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs16', 27)" onmouseover="showTip(event, 'fs16', 27)" class="p">None</span>
</code></pre></td>
</tr>
</table>
<h1><a name="Type-Erasure" class="anchor" href="#Type-Erasure">Type Erasure</a></h1>
<p>All the provided types in this library are erased to their underlying primitive types. Therefore
there is very little (if any) runtime overhead for using these dependent types, aside from the
necessary validation of inputs.</p>
<p>This may seem strange for <code>string</code>, since that is a sealed type, but this isn't inheritance. This
type provider is a program used by the compiler to create dependent types that constrain the range
of the type they are erased to; if you are familiar with units of measure, it is semantically very
similar.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> (<span onmouseout="hideTip(event, 'fs13', 28)" onmouseover="showTip(event, 'fs13', 28)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs17', 29)" onmouseover="showTip(event, 'fs17', 29)" class="i">p</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 30)" onmouseover="showTip(event, 'fs8', 30)" class="f">newProduct</span> <span class="s">&quot;Widgets&quot;</span> <span class="s">&quot;sprockets, whoozits, and whatsits for the discerning Who&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 31)" onmouseover="showTip(event, 'fs18', 31)" class="i">productName</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs10', 32)" onmouseover="showTip(event, 'fs10', 32)" class="t">string</span> <span class="o">=</span> <span class="k">upcast</span> (<span onmouseout="hideTip(event, 'fs17', 33)" onmouseover="showTip(event, 'fs17', 33)" class="i">p</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 34)" onmouseover="showTip(event, 'fs6', 34)" class="i">Name</span>)
</code></pre></td>
</tr>
</table>
<h1><a name="Bounded-Numbers" class="anchor" href="#Bounded-Numbers">Bounded Numbers</a></h1>
<p>Commonly we use <code>int</code> in our code out of convenience, where a different primitive might be more
efficient; the range of the value might fit into a much smaller type. Nevertheless, the real problem
here is that we should be able to define richer semantics in our domain without having to sacrifice
performance.</p>
<p>This library supports erased bounded types for <em>all</em> numeric primitives. Let's use a couple of these
to create some new types for our contrived example.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 35)" onmouseover="showTip(event, 'fs1', 35)" class="i">FSharp</span><span class="o">.</span><span class="i">DependentTypes</span><span class="o">.</span><span class="i">Numbers</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs19', 36)" onmouseover="showTip(event, 'fs19', 36)" class="t">LineItem</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs20', 37)" onmouseover="showTip(event, 'fs20', 37)" class="i">Product</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs20', 38)" onmouseover="showTip(event, 'fs20', 38)" class="t">Product</span>; <span onmouseout="hideTip(event, 'fs21', 39)" onmouseover="showTip(event, 'fs21', 39)" class="i">UnitPrice</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs22', 40)" onmouseover="showTip(event, 'fs22', 40)" class="t">ProductPrice</span>; <span onmouseout="hideTip(event, 'fs23', 41)" onmouseover="showTip(event, 'fs23', 41)" class="i">Quantity</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs24', 42)" onmouseover="showTip(event, 'fs24', 42)" class="t">AllowedQuantity</span> }
<span class="k">and</span> <span onmouseout="hideTip(event, 'fs22', 43)" onmouseover="showTip(event, 'fs22', 43)" class="t">ProductPrice</span> <span class="o">=</span> <span class="i">BoundedDecimal</span><span class="o">&lt;</span><span class="n">0.01m</span>, <span class="n">999.99m</span><span class="o">&gt;</span>
<span class="k">and</span> <span onmouseout="hideTip(event, 'fs24', 44)" onmouseover="showTip(event, 'fs24', 44)" class="t">AllowedQuantity</span> <span class="o">=</span> <span class="i">BoundedByte</span><span class="o">&lt;</span><span class="n">1uy</span>, <span class="n">99uy</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<h1><a name="Validation" class="anchor" href="#Validation">Validation</a></h1>
<p>The bounds for the <code>Bounded____</code> types are available as static properites.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// TODO validation</span>
</code></pre></td>
</tr>
</table>

<div class="tip" id="fs1">namespace Microsoft.FSharp</div>
<div class="tip" id="fs2">type ProductDescription = obj<br /><br />Full name: Tutorial.ProductDescription</div>
<div class="tip" id="fs3">type ProductName = obj<br /><br />Full name: Tutorial.ProductName</div>
<div class="tip" id="fs4">type OneChar = obj<br /><br />Full name: Tutorial.OneChar</div>
<div class="tip" id="fs5">type Product =<br />&#160;&#160;{Name: ProductName;<br />&#160;&#160;&#160;Description: ProductDescription;}<br /><br />Full name: Tutorial.Product</div>
<div class="tip" id="fs6">Product.Name: ProductName</div>
<div class="tip" id="fs7">Product.Description: ProductDescription</div>
<div class="tip" id="fs8">val newProduct : name:string -&gt; description:string -&gt; Product option<br /><br />Full name: Tutorial.newProduct</div>
<div class="tip" id="fs9">val name : string</div>
<div class="tip" id="fs10">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs11">val description : string</div>
<div class="tip" id="fs12">type &#39;T option = Option&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.option&lt;_&gt;</div>
<div class="tip" id="fs13">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs14">val n : obj</div>
<div class="tip" id="fs15">val d : obj</div>
<div class="tip" id="fs16">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs17">val p : Product<br /><br />Full name: Tutorial.p</div>
<div class="tip" id="fs18">val productName : string<br /><br />Full name: Tutorial.productName</div>
<div class="tip" id="fs19">type LineItem =<br />&#160;&#160;{Product: Product;<br />&#160;&#160;&#160;UnitPrice: ProductPrice;<br />&#160;&#160;&#160;Quantity: AllowedQuantity;}<br /><br />Full name: Tutorial.LineItem</div>
<div class="tip" id="fs20">Multiple items<br />LineItem.Product: Product<br /><br />--------------------<br />type Product =<br />&#160;&#160;{Name: ProductName;<br />&#160;&#160;&#160;Description: ProductDescription;}<br /><br />Full name: Tutorial.Product</div>
<div class="tip" id="fs21">LineItem.UnitPrice: ProductPrice</div>
<div class="tip" id="fs22">type ProductPrice = obj<br /><br />Full name: Tutorial.ProductPrice</div>
<div class="tip" id="fs23">LineItem.Quantity: AllowedQuantity</div>
<div class="tip" id="fs24">type AllowedQuantity = obj<br /><br />Full name: Tutorial.AllowedQuantity</div>

        </div>
        <div class="span3">
          <img src="/DependentTypesProvider/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">DependentTypesProvider</li>
            <li><a href="/DependentTypesProvider/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/DependentTypesProvider">Get Library via NuGet</a></li>
            <li><a href="http://github.com/caindy/DependentTypesProvider">Source Code on GitHub</a></li>
            <li><a href="/DependentTypesProvider/license.html">License</a></li>
            <li><a href="/DependentTypesProvider/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/DependentTypesProvider/tutorial.html">Sample tutorial</a></li>

            <li class="nav-header">Documentation</li>
            <!--<li><a href="/DependentTypesProvider/reference/index.html">API Reference</a></li>
            not really valueable for our type provider -->
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/caindy/DependentTypesProvider"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
